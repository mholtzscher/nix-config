#!/usr/bin/env bash
# nixos-launch-webapp - Launch web URLs as standalone applications
# Usage: nixos-launch-webapp <url> [browser-name]

set -euo pipefail

URL="${1:-}"
BROWSER="${2:-firefox}"

if [[ -z "$URL" ]]; then
    echo "Error: No URL provided"
    echo "Usage: nixos-launch-webapp <url> [browser]"
    exit 1
fi

# Launch based on available browser
case "$BROWSER" in
    firefox)
        if command -v firefox &> /dev/null; then
            exec firefox --new-window --kiosk "$URL"
        fi
        ;;
    chromium)
        if command -v chromium &> /dev/null; then
            exec chromium --app="$URL" \
                --enable-features=WebUIDarkMode,WebContentsForceDark \
                --force-dark-mode
        fi
        ;;
    google-chrome)
        if command -v google-chrome-stable &> /dev/null; then
            exec google-chrome-stable --app="$URL" \
                --enable-features=WebUIDarkMode,WebContentsForceDark \
                --force-dark-mode
        fi
        ;;
    zen-browser)
        if command -v zen-browser &> /dev/null; then
            exec zen-browser --new-window "$URL"
        fi
        ;;
    *)
        echo "Error: Unknown browser '$BROWSER'"
        exit 1
        ;;
esac

# Fallback: Try any available browser
if command -v firefox &> /dev/null; then
    exec firefox --new-window "$URL"
elif command -v chromium &> /dev/null; then
    exec chromium --app="$URL" \
        --enable-features=WebUIDarkMode,WebContentsForceDark \
        --force-dark-mode
elif command -v xdg-open &> /dev/null; then
    exec xdg-open "$URL"
else
    echo "Error: No suitable browser found"
    exit 1
fi
